#!/bin/sh
#
# This hook was set by cargo-husky v1.5.0: https://github.com/rhysd/cargo-husky#readme
# Generated by script /Users/shufflebottomhogwood/.cargo/registry/src/index.crates.io-6f17d22bba15001f/cargo-husky-1.5.0/build.rs
# Output at /Users/shufflebottomhogwood/Code/excalibur/target/debug/build/cargo-husky-e97043955f0b7beb/out
#

set -e

echo '+cargo build --all'
cargo build --all

protected_branch='main'
current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')
remote_name=$(git for-each-ref --format='%(upstream:short)' $(git symbolic-ref -q HEAD))
remote_name=${remote_name%/$protected_branch}
remote_name=${remote_name#refs/remotes/}

if [[ $current_branch = $protected_branch && $remote_name = 'origin' ]]; then
    echo 'error: you are trying to push to main, which is not allowed.'
    exit 1
fi
